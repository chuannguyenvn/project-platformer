(()=>{"use strict";var e,t={865:(e,t,i)=>{var s,a=i(260),r=i.n(a);!function(e){let t,i,s,a,r,n;!function(e){e.DEFAULT="key.audio.default"}(t=e.Audio||(e.Audio={})),function(e){e.CIRCLE="key.sprite.circle",e.SQUARE="key.sprite.square",e.GRADIENT_TOP_TO_BOTTOM="key.sprite.gradient-top-to-bottom",e.KENNEY_DEFAULT_TILESET="key.sprite.kenney-default-tileset",e.COIN_FRONT="key.sprite.coin-front",e.COIN_SIDE="key.sprite.coin-side",e.SPIKE="key.sprite.spike",e.DOOR="key.sprite.door",e.FLAG_1="key.sprite.flag-1",e.FLAG_2="key.sprite.flag-2",e.KEY="key.sprite.key",e.LOCK="key.sprite.lock",e.LOCK_WALL="key.sprite.lock-wall",e.CASTLE="key.sprite.castle",e.SPRING_COMPRESSED="key.sprite.spring-compressed",e.SPRING_RELEASED="key.sprite.spring-released",e.PLAYER_IDLE="key.sprite.player-idle",e.PLAYER_RUNNING="key.sprite.player-running",e.BACKGROUND="ley.sprite.background"}(i=e.Sprite||(e.Sprite={})),function(e){e.COIN="key.animation.coin",e.PLAYER_RUNNING="key.animation.player-running",e.FLAG_WAVING="ley.animation.flag-waving"}(s=e.Animation||(e.Animation={})),function(e){e.BOOT="key.scene.boot",e.LOAD="key.scene.load",e.PLAY="key.scene.play"}(a=e.Scene||(e.Scene={})),function(e){let t,i,s,a;!function(e){let t,i,s,a,r;!function(e){e[e.COL_MID=120]="COL_MID",e[e.MID_LEFT=121]="MID_LEFT",e[e.MID_MID=122]="MID_MID",e[e.MID_RIGHT=123]="MID_RIGHT",e[e.COL_BOT=140]="COL_BOT",e[e.BOT_LEFT=141]="BOT_LEFT",e[e.BOT_MID=142]="BOT_MID",e[e.BOT_RIGHT=143]="BOT_RIGHT",e[e.CORNER_TOP_LEFT=4]="CORNER_TOP_LEFT",e[e.CORNER_TOP_RIGHT=5]="CORNER_TOP_RIGHT",e[e.CORNER_BOT_LEFT=24]="CORNER_BOT_LEFT",e[e.CORNER_BOT_RIGHT=25]="CORNER_BOT_RIGHT"}(t=e.Base||(e.Base={})),function(e){e[e.UNIT=0]="UNIT",e[e.ROW_LEFT=1]="ROW_LEFT",e[e.ROW_MID=2]="ROW_MID",e[e.ROW_RIGHT=3]="ROW_RIGHT",e[e.COL_TOP=20]="COL_TOP",e[e.TOP_LEFT=21]="TOP_LEFT",e[e.TOP_MID=22]="TOP_MID",e[e.TOP_RIGHT=23]="TOP_RIGHT"}(i=e.Grass||(e.Grass={})),function(e){e[e.UNIT=40]="UNIT",e[e.ROW_LEFT=41]="ROW_LEFT",e[e.ROW_MID=42]="ROW_MID",e[e.ROW_RIGHT=43]="ROW_RIGHT",e[e.COL_TOP=60]="COL_TOP",e[e.TOP_LEFT=61]="TOP_LEFT",e[e.TOP_MID=62]="TOP_MID",e[e.TOP_RIGHT=63]="TOP_RIGHT"}(s=e.Dessert||(e.Dessert={})),function(e){e[e.UNIT=80]="UNIT",e[e.ROW_LEFT=81]="ROW_LEFT",e[e.ROW_MID=82]="ROW_MID",e[e.ROW_RIGHT=83]="ROW_RIGHT",e[e.COL_TOP=100]="COL_TOP",e[e.TOP_LEFT=101]="TOP_LEFT",e[e.TOP_MID=102]="TOP_MID",e[e.TOP_RIGHT=103]="TOP_RIGHT"}(a=e.Snowy||(e.Snowy={})),function(e){e[e.UNIT=47]="UNIT",e[e.LEFT=48]="LEFT",e[e.MID=49]="MID",e[e.RIGHT=50]="RIGHT"}(r=e.WoodenPlank||(e.WoodenPlank={}))}(t=e.Terrain||(e.Terrain={})),function(e){e[e.PLANT_SMALL=124]="PLANT_SMALL",e[e.PLANT_LARGE=125]="PLANT_LARGE",e[e.PINE_TREE=126]="PINE_TREE",e[e.CACTUS=127]="CACTUS",e[e.MUSHROOM_RED=128]="MUSHROOM_RED",e[e.MUSHROOM_BROWN=129]="MUSHROOM_BROWN"}(i=e.Decorations||(e.Decorations={})),function(e){e[e.KEY=27]="KEY",e[e.LEVER_LEFT=64]="LEVER_LEFT",e[e.LEVER_MID=65]="LEVER_MID",e[e.LEVER_RIGHT=66]="LEVER_RIGHT",e[e.DIAMOND=67]="DIAMOND",e[e.SPRING_COMPRESSED=107]="SPRING_COMPRESSED",e[e.SPRING_RELEASED=108]="SPRING_RELEASED",e[e.DOOR_TOP=110]="DOOR_TOP",e[e.DOOR_WITH_WINDOW=130]="DOOR_WITH_WINDOW",e[e.DOOR_NO_WINDOW=150]="DOOR_NO_WINDOW",e[e.COIN_FRONT=151]="COIN_FRONT",e[e.COIN_SIDE=152]="COIN_SIDE"}(s=e.Interactables||(e.Interactables={})),function(e){let t;!function(e){let t,i;!function(e){let t,i;!function(e){e[e.BOTTOM=72]="BOTTOM",e[e.MID=52]="MID",e[e.TOP=32]="TOP"}(t=e.Trunk||(e.Trunk={})),function(e){e[e.WITH_TRUNK=12]="WITH_TRUNK",e[e.NO_TRUNK=13]="NO_TRUNK",e[e.LEFT=14]="LEFT",e[e.RIGHT=15]="RIGHT"}(i=e.Canopy||(e.Canopy={}))}(t=e.Mushroom||(e.Mushroom={})),function(e){let t,i,s;!function(e){e[e.BOTTOM=72]="BOTTOM",e[e.MID=52]="MID",e[e.TOP=32]="TOP"}(t=e.Trunk||(e.Trunk={})),function(e){e[e.WITH_TRUNK=12]="WITH_TRUNK",e[e.NO_TRUNK=13]="NO_TRUNK",e[e.LEFT=14]="LEFT",e[e.RIGHT=15]="RIGHT"}(i=e.Canopy||(e.Canopy={})),function(e){e[e.WITH_LEAVES_LEFT=0]="WITH_LEAVES_LEFT",e[e.NO_LEAVES_LEFT=1]="NO_LEAVES_LEFT",e[e.NO_LEAVES_RIGHT=2]="NO_LEAVES_RIGHT",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT",e[e.WITH_LEAVES_MID=5]="WITH_LEAVES_MID",e[e.NO_LEAVES_MID=6]="NO_LEAVES_MID"}(s=e.Branch||(e.Branch={}))}(i=e.Wooden||(e.Wooden={}))}(t=e.Trees||(e.Trees={}))}(a=e.Props||(e.Props={}))}(r=e.Tileset||(e.Tileset={})),function(e){e.LEVEL_1="key.tilemap.level-1",e.LEVEL_2="key.tilemap.level-2",e.LEVEL_3="key.tilemap.level-3"}(n=e.Tilemap||(e.Tilemap={}))}(s||(s={}));var n,l=s.Tileset;class o{static getCollidableTiles(){const e=[];function t(t){Object.values(t).forEach((t=>{"number"==typeof t&&e.push(t+1)}))}return t(l.Terrain.Base),t(l.Terrain.Grass),t(l.Terrain.Dessert),t(l.Terrain.Snowy),t(l.Terrain.WoodenPlank),e.push(10),e}}o.FileLookUp={[s.Audio.DEFAULT]:"",[s.Sprite.CIRCLE]:"./assets/images/circle.png",[s.Sprite.SQUARE]:"./assets/images/square.png",[s.Sprite.COIN_FRONT]:"./assets/images/coin-front.png",[s.Sprite.COIN_SIDE]:"./assets/images/coin-side.png",[s.Sprite.SPIKE]:"./assets/images/spike.png",[s.Sprite.DOOR]:"./assets/images/door.png",[s.Sprite.FLAG_1]:"./assets/images/flag-1.png",[s.Sprite.FLAG_2]:"./assets/images/flag-2.png",[s.Sprite.KEY]:"./assets/images/key.png",[s.Sprite.LOCK]:"./assets/images/lock.png",[s.Sprite.LOCK_WALL]:"./assets/images/lock-wall.png",[s.Sprite.CASTLE]:"./assets/images/castle.jpg",[s.Sprite.SPRING_COMPRESSED]:"./assets/images/spring-compressed.png",[s.Sprite.SPRING_RELEASED]:"./assets/images/spring-released.png",[s.Sprite.PLAYER_IDLE]:"./assets/images/player-idle.png",[s.Sprite.PLAYER_RUNNING]:"./assets/images/player-running.png",[s.Sprite.GRADIENT_TOP_TO_BOTTOM]:"./assets/images/gradient-top-to-bottom.png",[s.Sprite.KENNEY_DEFAULT_TILESET]:"./assets/images/kenney-pixel-platformer.png",[s.Sprite.BACKGROUND]:"./assets/images/background.png",[s.Tilemap.LEVEL_1]:"./assets/tiled/level-1.json",[s.Tilemap.LEVEL_2]:"./assets/tiled/level-2.json",[s.Tilemap.LEVEL_3]:"./assets/tiled/level-3.json"},function(e){e[e.PORTAL_COOLDOWN=250]="PORTAL_COOLDOWN"}(n||(n={}));class h extends a.Scene{constructor(){super({key:s.Scene.BOOT})}preload(){}create(){this.scene.start(s.Scene.LOAD)}}const c=h,p=class{static preloadSprite(e,t){e.load.image(t,o.FileLookUp[t])}static preloadSound(e,t){e.load.audio(t,o.FileLookUp[t])}static preloadTilemap(e,t){e.load.tilemapTiledJSON(t,o.FileLookUp[t])}};class y extends Phaser.GameObjects.Sprite{constructor(e){super(e,0,0,s.Sprite.SQUARE),e.add.existing(this),this.setTintFill(0),this.circle=e.make.graphics().fillCircle(0,0,100),this.setMask(this.circle.createGeometryMask()),this.setDepth(1e4),this.setDisplaySize(1e4,1e4),this.mask.invertAlpha=!0,this.setVisible(!0)}closeAt(e,t,i=Phaser.Math.Easing.Circular.Out,s=1e3){this.circle.x=e,this.circle.y=t,this.setVisible(!0),this.scene.tweens.add({targets:this.circle,scale:0,ease:i,duration:s})}openAt(e,t){this.circle.x=e,this.circle.y=t,this.circle.scale=0,this.scene.tweens.add({targets:this.circle,scale:10,duration:600,ease:Phaser.Math.Easing.Circular.In,onComplete:()=>this.setVisible(!1)})}openSlightlyAt(e,t){this.circle.x=e,this.circle.y=t,this.circle.scale=0,this.scene.tweens.add({targets:this.circle,scale:2,duration:400,ease:Phaser.Math.Easing.Back.Out})}}const d=y;class u extends a.Scene{constructor(){super({key:s.Scene.LOAD})}preload(){p.preloadSprite(this,s.Sprite.KENNEY_DEFAULT_TILESET),p.preloadTilemap(this,s.Tilemap.LEVEL_1),p.preloadTilemap(this,s.Tilemap.LEVEL_2),p.preloadTilemap(this,s.Tilemap.LEVEL_3),p.preloadSprite(this,s.Sprite.COIN_SIDE),p.preloadSprite(this,s.Sprite.COIN_FRONT),p.preloadSprite(this,s.Sprite.SPIKE),p.preloadSprite(this,s.Sprite.DOOR),p.preloadSprite(this,s.Sprite.FLAG_1),p.preloadSprite(this,s.Sprite.FLAG_2),p.preloadSprite(this,s.Sprite.KEY),p.preloadSprite(this,s.Sprite.LOCK),p.preloadSprite(this,s.Sprite.LOCK_WALL),p.preloadSprite(this,s.Sprite.CASTLE),p.preloadSprite(this,s.Sprite.SPRING_COMPRESSED),p.preloadSprite(this,s.Sprite.SPRING_RELEASED),p.preloadSprite(this,s.Sprite.PLAYER_IDLE),p.preloadSprite(this,s.Sprite.PLAYER_RUNNING),p.preloadSprite(this,s.Sprite.BACKGROUND),p.preloadSprite(this,s.Sprite.SQUARE)}create(){this.anims.create({key:s.Animation.PLAYER_RUNNING,frames:[{key:s.Sprite.PLAYER_IDLE},{key:s.Sprite.PLAYER_RUNNING}],frameRate:6,repeat:-1}),this.anims.create({key:s.Animation.FLAG_WAVING,frames:[{key:s.Sprite.FLAG_1},{key:s.Sprite.FLAG_2}],frameRate:3,repeat:-1}),this.transitionScreen=new d(this),this.transitionScreen.openSlightlyAt(this.scale.width/2,this.scale.height/2),this.player=this.add.image(this.scale.width/2,.3*this.scale.height,s.Sprite.PLAYER_RUNNING),this.player.setScale(2),this.tweens.add({targets:this.player,y:.7*this.scale.height,duration:1e3,repeat:-1}),this.tweens.add({targets:this.player,rotation:r().Math.PI2,duration:2345,repeat:-1}),this.add.image(this.scale.width/2,.2*this.scale.height,s.Sprite.SQUARE).setTintFill(255).setScale(1.5),this.add.image(this.scale.width/2,.8*this.scale.height,s.Sprite.SQUARE).setTintFill(16746496).setScale(1.5),this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,s.Sprite.BACKGROUND).setDepth(-1);const e=this.add.text(this.scale.width/2,.15*this.scale.height,"Platformer game").setFont("100px calibri").setColor("#ffffff").setOrigin(.5).setDepth(1e5),t=this.add.text(this.scale.width/2,.2*this.scale.height,"(with portals?!)").setFont("25px calibri").setColor("#ffffff").setOrigin(.5).setDepth(1e5),i=this.add.text(this.scale.width/2,.85*this.scale.height,"Click anywhere to continue").setFont("50px calibri").setColor("#ffffff").setOrigin(.5).setDepth(1e5);this.input.on(r().Input.Events.POINTER_UP,(()=>{e.setVisible(!1),t.setVisible(!1),i.setVisible(!1),this.transitionScreen.closeAt(this.scale.width/2,this.scale.height/2,r().Math.Easing.Back.In,400),this.time.delayedCall(1e3,(()=>this.scene.start(s.Scene.PLAY)))}))}}const S=u;var T,E=Phaser.Math.Vector2,L=Phaser.Physics.Arcade.Sprite;class O extends L{constructor(e,t){super(e,-1e4,-1e4,s.Sprite.CIRCLE),this.orientation=E.UP,this.isActive=!1,this.playScene=e,this.playScene.physics.add.existing(this),this.playScene.add.existing(this),this.setDisplaySize(24,24),t?this.setTintFill(255):this.setTintFill(16746496),this.setDrag(1e5)}setOrientation(e){switch(e){case T.UP:this.orientation=E.UP,this.setRotation(.75*Phaser.Math.PI2);break;case T.DOWN:this.orientation=E.DOWN,this.setRotation(.25*Phaser.Math.PI2);break;case T.LEFT:this.orientation=E.LEFT,this.setRotation(.5*Phaser.Math.PI2);break;case T.RIGHT:this.orientation=E.RIGHT,this.setRotation(0)}}}!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}(T||(T={}));var g=Phaser.Math.Vector3;class _{static DegreeAngleBetween(e,t){const i=e.clone(),s=t.clone();return Math.acos((i.x*s.x+i.y*s.y)/(e.length()*t.length()))*Phaser.Math.RAD_TO_DEG}static SignedDegreeAngleBetween(e,t){const i=e.clone(),s=t.clone(),a=Math.acos((i.x*s.x+i.y*s.y)/(e.length()*t.length()))*Phaser.Math.RAD_TO_DEG,r=new g(0,0,i.x*s.y-s.x*i.y);return g.FORWARD.clone().dot(r)<0?a:-a}static IsPointBetween(e,t,i){const s=Phaser.Math.Distance.BetweenPoints(t,i),a=Phaser.Math.Distance.BetweenPoints(e,t),r=Phaser.Math.Distance.BetweenPoints(e,i);return Math.abs(a+r-s)<Phaser.Math.EPSILON}static clampLength(e,t){return(e=e.clone()).length()>t&&(e=e.scale(e.length()/t)),e}static lerpVector2(e,t,i){const s=Phaser.Math.Linear(e.x,t.x,i),a=Phaser.Math.Linear(e.y,t.y,i);return new Phaser.Math.Vector2(s,a)}static lerpVector2ByDistance(e,t,i){const s=e.distance(t),a=Phaser.Math.Clamp(i/s,0,1);return _.lerpVector2(e,t,a)}}const m=_;class I{constructor(e,t){this.state=e,this.callback=t}}var R,P=r().Physics.Arcade.Sprite,D=r().Math.Vector2,N=s.Tilemap;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.JUMPING=2]="JUMPING"}(R||(R={}));const M=class extends P{constructor(e,t=0,i=0){super(e,t,i,s.Sprite.PLAYER_IDLE),this.playerStateMachine=new class{constructor(e,t=!1){this.onEntryCallbacks=[],this.onExitCallbacks=[],this._currentState=e,this.sameStateInvoke=t}get currentState(){return this._currentState}changeState(e){if(this.sameStateInvoke||this._currentState!==e){for(let e=0;e<this.onExitCallbacks.length;e++)this.onExitCallbacks[e].state===this._currentState&&this.onExitCallbacks[e].callback();for(let t=0;t<this.onEntryCallbacks.length;t++)this.onEntryCallbacks[t].state===e&&this.onEntryCallbacks[t].callback();this._currentState=e}}configure(e){return this.configuringState=e,this}onEntry(e){return this.onEntryCallbacks.push(new I(this.configuringState,e)),this}onExit(e){return this.onExitCallbacks.push(new I(this.configuringState,e)),this}}(R.IDLE),this.channelingMomentum=1,this.releaseMomentum=1,this.xFriction=1,this.forceWalkOut=!1,e.physics.add.existing(this),e.add.existing(this),this.playScene=e,this.playScene.cursors.space.on(r().Input.Keyboard.Events.DOWN,(()=>{this.body.blocked.down&&(this.playerStateMachine.changeState(R.JUMPING),this.body.setVelocityY(-500))})),this.playerStateMachine.configure(R.IDLE).onEntry((()=>{this.setTexture(s.Sprite.PLAYER_IDLE)})),this.playerStateMachine.configure(R.JUMPING).onEntry((()=>{this.setTexture(s.Sprite.PLAYER_RUNNING)})),this.playerStateMachine.configure(R.RUNNING).onEntry((()=>{this.stop(),this.play(s.Animation.PLAYER_RUNNING)})),this.playerStateMachine.configure(R.RUNNING).onExit((()=>{this.stop()})),this.gravityTween=this.playScene.tweens.addCounter({from:0,to:100,duration:250,ease:r().Math.Easing.Sine.InOut,onUpdate:e=>{this.setGravityY(e.getValue()),this.xFriction=e.getValue()/100}}),this.flipX=!0}update(e,t){this.forceWalkOut?this.body.setVelocityX(200):(this.handleMovement(t),this.handleGun(),this.checkFallOffMap())}handleMovement(e){var t,i;this.channelingMomentum=Math.max(this.channelingMomentum-e/2e3,1),(null===(t=this.body)||void 0===t?void 0:t.blocked.down)?(this.playerStateMachine.currentState==R.JUMPING&&this.playerStateMachine.changeState(R.IDLE),this.body.setVelocityX(.75*this.body.velocity.x)):(this.playerStateMachine.changeState(R.JUMPING),this.body.setVelocityX(this.body.velocity.x*(1-this.xFriction/100))),this.playScene.godMode?(this.setVelocity(0),this.playScene.aKey.isDown&&(this.x-=e),this.playScene.dKey.isDown&&(this.x+=e),this.playScene.wKey.isDown&&(this.y-=e),this.playScene.sKey.isDown&&(this.y+=e)):this.playScene.aKey.isDown?(this.playerStateMachine.currentState!==R.JUMPING&&this.playerStateMachine.changeState(R.RUNNING),this.body.setVelocityX(-200),this.flipX=!1):this.playScene.dKey.isDown?(this.playerStateMachine.currentState!==R.JUMPING&&this.playerStateMachine.changeState(R.RUNNING),this.body.setVelocityX(200),this.flipX=!0):this.playerStateMachine.changeState(R.IDLE),this.lastFrameVelocity=null===(i=this.body)||void 0===i?void 0:i.velocity,this.overlapingPortalLastFrame=this.overlapingPortalThisFrame,this.overlapingPortalThisFrame=null}handleGun(){const e=this.playScene.cameras.main.getWorldPoint(this.playScene.input.activePointer.x,this.playScene.input.activePointer.y),t=r().Math.Angle.Between(this.x,this.y,e.x,e.y);this.playScene.ray.setOrigin(this.x,this.y),this.playScene.ray.setAngle(t);const i=this.playScene.ray.cast();if(!1===i)return;const s=i;if(void 0===s.segment)return;let a;if(this.playScene.leftMouseDown)a=this.playScene.bluePortal;else{if(!this.playScene.rightMouseDown)return;a=this.playScene.orangePortal}if("gold_tiles"!==s.object.layer.name)return;const n=s.segment;s.x>this.x?s.y>this.y?n.x1===n.x2?a.setOrientation(T.LEFT):a.setOrientation(T.UP):n.x1===n.x2?a.setOrientation(T.LEFT):a.setOrientation(T.DOWN):s.y>this.y?n.x1===n.x2?a.setOrientation(T.RIGHT):a.setOrientation(T.UP):n.x1===n.x2?a.setOrientation(T.RIGHT):a.setOrientation(T.DOWN),a.setPosition(s.x,s.y),a.isActive=!0,this.releaseMomentum=this.channelingMomentum,this.channelingMomentum=1}handleSpringCollision(){this.body.setVelocityY(-700)}checkFallOffMap(){this.y>900&&this.die()}enterPortal(e){if(this.overlapingPortalLastFrame!==e){if(e.isActive&&e.destinationPortal.isActive){if(this.setPosition(e.destinationPortal.x+20*e.destinationPortal.orientation.x,e.destinationPortal.y+20*e.destinationPortal.orientation.y),this.overlapingPortalThisFrame=e.destinationPortal,e.orientation===e.destinationPortal.orientation){let t=r().Math.Clamp(this.lastFrameVelocity.x*this.releaseMomentum,-1e4,1e4),i=r().Math.Clamp(this.lastFrameVelocity.y*this.releaseMomentum,-1500,1500);e.orientation===D.UP||e.orientation===D.DOWN?i*=-1:t*=-1,this.setVelocity(t,i)}else{const t=m.SignedDegreeAngleBetween(e.orientation.clone(),e.destinationPortal.orientation.clone());180!==Math.abs(t)&&(t>0?this.setVelocity(-this.lastFrameVelocity.y,this.lastFrameVelocity.x):this.setVelocity(this.lastFrameVelocity.y,-this.lastFrameVelocity.x))}this.channelingMomentum+=.25,this.releaseMomentum=1,this.gravityTween.play()}}else this.overlapingPortalThisFrame=e}win(){this.forceWalkOut=!0,this.playScene.time.delayedCall(2e3,(()=>{this.playScene.currentLevel===N.LEVEL_1?this.playScene.loadLevel(N.LEVEL_2):this.playScene.currentLevel===N.LEVEL_2&&this.playScene.loadLevel(N.LEVEL_3)}))}die(){this.setDrag(1e4),this.playScene.loadLevel(this.playScene.currentLevel)}};var k=r().Physics.Arcade.Sprite;const C=class extends k{constructor(e,t,i,s,a=!1){super(e,t,i,s),this.playScene=e,this.playScene.physics.add.existing(this,a),this.playScene.add.existing(this),this.playScene.time.delayedCall(0,(()=>{this.setTexture(s),this.setDisplaySize(18,18)}))}},v=class extends C{constructor(e,t=0,i=0){super(e,t,i,s.Sprite.SPIKE),this.playScene.time.delayedCall(0,(()=>{this.setTexture(s.Sprite.SPIKE),this.setDisplaySize(18,18)}))}},A=class extends C{constructor(e,t=0,i=0){super(e,t,i,s.Sprite.SPRING_COMPRESSED),e.time.delayedCall(0,(()=>{this.setTexture(s.Sprite.SPRING_COMPRESSED),this.setDisplaySize(18,18)}))}release(){this.setTexture(s.Sprite.SPRING_RELEASED),this.playScene.time.delayedCall(1,(()=>{this.setTexture(s.Sprite.SPRING_COMPRESSED)}))}};var f=i(492),G=i.n(f);const x=class extends C{constructor(e,t=0,i=0){super(e,t,i,s.Sprite.DOOR),this.setDisplaySize(18,36),this.setBodySize(18,36),this.setOrigin(.5,1),this.setDrag(1e5)}};var b=Phaser.Math.Vector2;const F=class extends C{constructor(e,t=0,i=0){super(e,t,i,s.Sprite.KEY),this.isCollected=!1,this.playScene.time.delayedCall(0,(()=>{this.setTexture(s.Sprite.KEY),this.setDisplaySize(18,18)})),this.setDrag(1e5),this.setDepth(1)}update(e,t){this.targetingLock&&this.flyToLock(t),this.isCollected&&this.flyToPlayer(t)}flyToLock(e){if(!this.targetingLock)return;const t=new b(this.targetingLock.x,this.targetingLock.y),i=new b(this.x,this.y);if(Phaser.Math.Distance.Between(t.x,t.y,i.x,i.y)>5){const s=m.lerpVector2(i,t,7*e/1e3);this.x=s.x,this.y=s.y}else{const e=this.targetingLock;this.targetingLock=null,this.playScene.tweens.add({targets:this,scale:0,duration:800,ease:Phaser.Math.Easing.Back.In,onComplete:()=>{e.unlock(),this.destroy()}})}}flyToPlayer(e){const t=new b(this.playScene.player.x,this.playScene.player.y),i=new b(this.x,this.y);if(Phaser.Math.Distance.Between(t.x,t.y,i.x,i.y)>25){const s=m.lerpVector2ByDistance(t,i,25),a=m.lerpVector2(i,s,5*e/1e3);this.x=a.x,this.y=a.y}}collect(){this.isCollected=!0,this.playScene.currentKey=this}unlock(e){this.isCollected=!1,this.playScene.currentKey=null,this.targetingLock=e}};var w=Phaser.Math.Vector2;const U=class extends C{constructor(e,t=0,i=0){super(e,t,i,s.Sprite.LOCK),this.playScene.time.delayedCall(0,(()=>{this.setTexture(s.Sprite.LOCK),this.setDisplaySize(18,18)})),this.setImmovable(!0),this.setDrag(1e5)}update(e,t){var i;const s=new w(this.playScene.player.x,this.playScene.player.y),a=new w(this.x,this.y);Phaser.Math.Distance.Between(s.x,s.y,a.x,a.y)<100&&(null===(i=this.playScene.currentKey)||void 0===i||i.unlock(this))}unlock(){var e;this.lockWalls.forEach((e=>e.unlock())),this.collider.active=!1,this.setDrag(0),this.setMass(1),this.setAngularVelocity(Phaser.Math.Between(-1e3,1e3)),Phaser.Math.RandomXY(null===(e=this.body)||void 0===e?void 0:e.velocity,200),this.playScene.time.delayedCall(5e3,(()=>this.destroy()))}},V=class extends C{constructor(e,t=0,i=0){super(e,t,i,s.Sprite.LOCK_WALL),this.playScene.time.delayedCall(0,(()=>{this.setTexture(s.Sprite.LOCK_WALL),this.setDisplaySize(18,18)})),this.setImmovable(!0),this.setDrag(1e5)}unlock(){var e;this.setDrag(0),this.setMass(1),this.setAngularVelocity(Phaser.Math.Between(-1e3,1e3)),Phaser.Math.RandomXY(null===(e=this.body)||void 0===e?void 0:e.velocity,200),this.playScene.time.delayedCall(5e3,(()=>this.destroy()))}},W=class extends C{constructor(e,t=0,i=0){super(e,t,i,s.Sprite.FLAG_1),this.setDisplaySize(18,36),this.setBodySize(18,36),this.setOrigin(.5,1),this.setDrag(1e5),this.play(s.Animation.FLAG_WAVING)}};class K extends a.Scene{constructor(){super({key:s.Scene.PLAY}),this.godMode=!1,this.leftMouseDown=!1,this.rightMouseDown=!1,this.currentKey=null,this.currentLevel=s.Tilemap.LEVEL_1}create(){this.setUpInputs(),this.setUpPlayer(),this.setUpCamera(),this.setUpWorld(),this.setUpRaycasting(),this.setUpTransition()}setUpInputs(){var e,t,i,s,a,r,n,l;null===(e=this.input.mouse)||void 0===e||e.disableContextMenu(),this.cursors=null===(t=this.input.keyboard)||void 0===t?void 0:t.createCursorKeys(),this.wKey=null===(i=this.input.keyboard)||void 0===i?void 0:i.addKey("W"),this.aKey=null===(s=this.input.keyboard)||void 0===s?void 0:s.addKey("A"),this.sKey=null===(a=this.input.keyboard)||void 0===a?void 0:a.addKey("S"),this.dKey=null===(r=this.input.keyboard)||void 0===r?void 0:r.addKey("D"),this.pKey=null===(n=this.input.keyboard)||void 0===n?void 0:n.addKey("P"),this.oKey=null===(l=this.input.keyboard)||void 0===l?void 0:l.addKey("O"),this.input.on(Phaser.Input.Events.POINTER_DOWN,(()=>{this.input.activePointer.leftButtonDown()?(this.leftMouseDown=!0,this.time.delayedCall(0,(()=>this.leftMouseDown=!1))):this.input.activePointer.rightButtonDown()&&(this.rightMouseDown=!0,this.time.delayedCall(0,(()=>this.rightMouseDown=!1)))}))}setUpPlayer(){this.latestCheckpoint?this.player=new M(this,this.latestCheckpoint.x,this.latestCheckpoint.y):this.currentLevel===s.Tilemap.LEVEL_3?this.player=new M(this,300,600):this.player=new M(this,300,700),this.playerGroup=this.add.group([this.player],{runChildUpdate:!0}),this.bluePortal=new O(this,!0),this.orangePortal=new O(this,!1),this.bluePortal.destinationPortal=this.orangePortal,this.orangePortal.destinationPortal=this.bluePortal,this.portals=[this.bluePortal,this.orangePortal],this.add.group(this.portals,{runChildUpdate:!0})}setUpCamera(){var e;this.cameras.main.setZoom(2),this.cameras.main.startFollow(this.playerGroup.getChildren()[0],!1,.2,.2,0,0);const t=null===(e=this.input.keyboard)||void 0===e?void 0:e.createCursorKeys(),i={camera:this.cameras.main,left:null==t?void 0:t.left,right:null==t?void 0:t.right,up:null==t?void 0:t.up,down:null==t?void 0:t.down,speed:.5};this.controls=new Phaser.Cameras.Controls.FixedKeyControl(i),this.background=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,s.Sprite.BACKGROUND),this.background.setOrigin(.5),this.background.setDepth(-1e3),this.background.setScrollFactor(0,.2),this.background.setScale(3),this.cameras.main.setBounds(50,0,4200,840)}setUpWorld(){this.physics.world.TILE_BIAS=18;const e=this.make.tilemap({key:this.currentLevel});if(this.tileset=e.addTilesetImage("tiles_packed",s.Sprite.KENNEY_DEFAULT_TILESET),this.terrainTilemapLayer=e.createLayer("terrain",this.tileset),this.terrainTilemapLayer.setCollision(o.getCollidableTiles()),this.spikes=e.createFromObjects("objects",{name:"spike",classType:v}),this.springs=e.createFromObjects("objects",{name:"spring",classType:A}),this.keys=e.createFromObjects("objects",{name:"key",classType:F}),this.checkpoints=e.createFromObjects("objects",{name:"checkpoint",classType:W}),this.currentLevel===s.Tilemap.LEVEL_3){this.locks=[],this.lockWalls=[];for(let t=0;t<8;t++){const i=e.createFromObjects("objects",{name:"lock-"+t,classType:U}),s=e.createFromObjects("objects",{name:"lock-wall-"+t,classType:V});i[0].lockWalls=s,this.locks.push(i[0]),this.lockWalls=this.lockWalls.concat(s),i[0].collider=this.physics.add.collider(this.playerGroup,i.concat(s))}const t=this.add.image(3965,450,s.Sprite.CASTLE);t.setDisplaySize(275,150),t.setDepth(-100),t.setOrigin(0,1)}this.goal=e.createFromObjects("objects",{name:"goal",classType:x})[0],this.decorationTilemapLayer=e.createLayer("decoration",this.tileset),this.goldTilemapLayer=e.createLayer("gold_tiles",this.tileset),this.goldTilemapLayer.setCollision([10]),this.physics.add.collider(this.playerGroup,this.terrainTilemapLayer),this.physics.add.collider(this.playerGroup,this.goldTilemapLayer),this.physics.add.collider(this.spikes,this.terrainTilemapLayer),this.physics.add.collider(this.springs,this.terrainTilemapLayer),this.add.group(this.keys,{runChildUpdate:!0}),this.add.group(this.locks,{runChildUpdate:!0})}setUpRaycasting(){this.raycasterPlugin=new(G())(this,this.plugins),this.raycaster=this.raycasterPlugin.createRaycaster({debug:{enabled:!0,maps:!1,rays:!0}}),this.raycaster.mapGameObjects(this.terrainTilemapLayer,!1,{collisionTiles:o.getCollidableTiles()}),this.raycaster.mapGameObjects(this.goldTilemapLayer,!1,{collisionTiles:[10]}),this.ray=this.raycaster.createRay()}setUpTransition(){this.transitionScreen=new d(this),this.transitionScreen.openAt(this.player.x,this.player.y)}update(e,t){this.handleGodMode(),this.controls.update(t),this.physics.world.overlap(this.playerGroup,this.spikes,((e,t)=>{e.die()})),this.physics.world.overlap(this.playerGroup,this.springs,((e,t)=>{e.handleSpringCollision(),t.release()})),this.physics.world.overlap(this.playerGroup,this.portals,((e,t)=>{e.enterPortal(t)})),this.physics.world.overlap(this.playerGroup,this.goal,((e,t)=>{e.win()})),this.physics.world.overlap(this.playerGroup,this.keys,((e,t)=>{t.collect()})),this.physics.world.overlap(this.playerGroup,this.checkpoints,((e,t)=>{this.latestCheckpoint=t}))}handleGodMode(){this.pKey.isDown?(this.godMode=!0,console.log("GOD MODE!!!")):this.oKey.isDown&&(this.godMode=!1,console.log("peasant mode")),this.godMode&&(this.cursors.right.isDown?this.currentLevel===s.Tilemap.LEVEL_1?this.loadLevel(s.Tilemap.LEVEL_2):this.currentLevel===s.Tilemap.LEVEL_2&&this.loadLevel(s.Tilemap.LEVEL_3):this.cursors.left.isDown&&(this.currentLevel===s.Tilemap.LEVEL_2?this.loadLevel(s.Tilemap.LEVEL_1):this.currentLevel===s.Tilemap.LEVEL_3&&this.loadLevel(s.Tilemap.LEVEL_2)))}loadLevel(e){e!==this.currentLevel&&(this.latestCheckpoint=null),this.transitionScreen.closeAt(this.player.x,this.player.y),this.time.delayedCall(1e3,(()=>{this.currentLevel=e,this.scene.start(s.Scene.PLAY)}))}}const B=K,H={parent:"game",scale:{mode:r().Scale.RESIZE},scene:[c,S,B],backgroundColor:16777215,physics:{default:"arcade",arcade:{debug:!1,gravity:{y:2e3}}},pixelArt:!0,plugins:{scene:[{key:"PhaserRaycaster",plugin:G(),mapping:"raycasterPlugin"}]}};class Y extends r().Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new Y(H)}))}},i={};function s(e){var a=i[e];if(void 0!==a)return a.exports;var r=i[e]={exports:{}};return t[e].call(r.exports,r,r.exports,s),r.exports}s.m=t,e=[],s.O=(t,i,a,r)=>{if(!i){var n=1/0;for(c=0;c<e.length;c++){for(var[i,a,r]=e[c],l=!0,o=0;o<i.length;o++)(!1&r||n>=r)&&Object.keys(s.O).every((e=>s.O[e](i[o])))?i.splice(o--,1):(l=!1,r<n&&(n=r));if(l){e.splice(c--,1);var h=a();void 0!==h&&(t=h)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[i,a,r]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var a,r,[n,l,o]=i,h=0;if(n.some((t=>0!==e[t]))){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(o)var c=o(s)}for(t&&t(i);h<n.length;h++)r=n[h],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(c)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a=s.O(void 0,[216],(()=>s(865)));a=s.O(a)})();